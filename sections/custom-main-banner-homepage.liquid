{{ 'homepage-main-banner.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-margin {
    margin-bottom: {{ section.settings.margin_bottom_desktop }}px;
  }

  /* Desktop vs Mobile media visibility (scoped to this section) */
  #{{ section.id }} .desktop-media {
    display: block;
    line-height:0;

  }
   #{{ section.id }} .desktop-media video{
    width:100%;
    height:auto;
    line-height:0;
   }

  #{{ section.id }} .mobile-media {
    display: none;
  }

  @media screen and (max-width: 750px) {
    .section-{{ section.id }}-margin {
      margin-bottom: {{ section.settings.margin_bottom_mobile }}px;
    }
    /* hide desktop media on mobile, show mobile media */
    #{{ section.id }} .desktop-media {
      display: none !important;
    }
    #{{ section.id }} .mobile-media {
      display: block !important;
      line-height:0;
    }
     #{{ section.id }} .mobile-media video{
        width: 100%;
    height: auto;
    object-fit: cover;
    line-height:0;
     }
    /* Position pagination centered below the CTA/button (scoped to this section) */
    #{{ section.id }} .swiper-pagination{
      display:flex;
      justify-content:center;
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      z-index:20;
      bottom:28px;
    }
  }
{%- endstyle -%}

{% if section.blocks != blank %}
  <section class="homepage-main-banner-container section-{{ section.id }}-margin" id="{{ section.id }}">
    <div class="homepage-main-banner">
      <div class="swiper main-banner-swiper">
        <div class="swiper-wrapper">
          {% for block in section.blocks %}
            <div class="swiper-slide relative">
              {%- comment -%} Desktop media: image or video {%- endcomment -%}
              <div class="desktop-media">
                {% if block.settings.desktop_media_type == 'video' and block.settings.desktop_banner_video != blank %}
                  {%- if forloop.index0 == 0 -%}
                    {% assign lazy = 'eager' %}
                  {%- else -%}
                    {% assign lazy = 'lazy' %}
                  {%- endif -%}
                  {{
                    block.settings.desktop_banner_video
                    | video_tag: image_size: '1600x', autoplay: true, muted: true, controls: false, loop: true
                  }}
                  <div class="desktop_banner_content {{ block.settings.content-position }}">
                    {% assign desktop_banner_text = block.settings.desktop_banner_text | split: '##' %}
                    {% if block.settings.desktop_banner_text != blank %}
                      <h2 class="desktop_banner_text1">{{ desktop_banner_text[0] }}</h2>
                      <h3 class="desktop_banner_text2">{{ desktop_banner_text[1] }}</h3>
                    {% endif %}
                    <div class="flex-27">
                      {% if block.settings.button_link1 != blank %}
                        <a href="{{ block.settings.button_link1 }}">
                          <h3
                            class="desktop_button_text1"
                            style="background-color:{{ block.settings.buttoncolor }}; color:{{ block.settings.buttontextcolor }}"
                          >
                            {{ block.settings.button_text1 }}
                          </h3>
                        </a>
                      {% endif %}
                    </div>
                  </div>
                {% elsif block.settings.desktop_banner_image != blank %}
                  {% if forloop.index0 == 0 %}
                    {% assign lazy = 'eager' %}
                  {% else %}
                    {% assign lazy = 'lazy' %}
                  {% endif %}
                  {% if block.settings.mobile_banner_image.alt %}
                    {% assign alt = block.settings.desktop_banner_image.alt %}
                  {% else %}
                    {% assign alt = 'Home Page Banner' %}
                  {% endif %}
                  {{
                    block.settings.desktop_banner_image
                    | image_url: width: 1600
                    | image_tag: class: 'desktop-banner-image', loading: lazy
                  }}
                  <div class="desktop_banner_content {{ block.settings.content-position }}">
                    {% assign desktop_banner_text = block.settings.desktop_banner_text | split: '##' %}
                    {% if block.settings.desktop_banner_text != blank %}
                      <h2 class="desktop_banner_text1">{{ desktop_banner_text[0] }}</h2>
                      <h3 class="desktop_banner_text2">{{ desktop_banner_text[1] }}</h3>
                    {% endif %}
                    <div class="flex-27">
                      {% if block.settings.button_link1 != blank %}
                        <a href="{{ block.settings.button_link1 }}">
                          <h3
                            class="desktop_button_text1"
                            style="background-color:{{ block.settings.buttoncolor }}; color:{{ block.settings.buttontextcolor }}"
                          >
                            {{ block.settings.button_text1 }}
                          </h3>
                        </a>
                      {% endif %}
                    </div>
                  </div>
                {% endif %}
              </div>

              {%- comment -%} Mobile media: image or video {%- endcomment -%}
              <div class="mobile-media">
                {% if block.settings.mobile_media_type == 'video' and block.settings.mobile_banner_video != blank %}
                  {%- if forloop.index0 == 0 -%}
                    {% assign lazy = 'eager' %}
                  {%- else -%}
                    {% assign lazy = 'lazy' %}
                  {%- endif -%}
                  {{
                    block.settings.mobile_banner_video
                    | video_tag: image_size: '600x', autoplay: true, muted: true, controls: false, loop: true
                  }}
                  <div class="mobile_banner_content {{ block.settings.content-position }}">
                    <div class="mobile_banner_content_div">
                      {% if block.settings.mobile_banner_text != blank %}
                        <h2 class="mobile_banner_text1">{{ block.settings.mobile_banner_text }}</h2>
                      {% endif %}
                      <div class="flex-11">
                        <a href="{{ block.settings.button_link1 }}">
                          <h3
                            class="mobile_button_text1"
                            style="background-color:{{ block.settings.buttoncolor }}; color:{{ block.settings.buttontextcolor }}"
                          >
                            {{ block.settings.button_text1 }}
                          </h3>
                        </a>
                      </div>
                    </div>
                  </div>
                {% elsif block.settings.mobile_banner_image != blank %}
                  {% if forloop.index0 == 0 %}
                    {% assign lazy = 'eager' %}
                  {% else %}
                    {% assign lazy = 'lazy' %}
                  {% endif %}
                  {% if block.settings.mobile_banner_image.alt %}
                    {% assign alt = image.alt %}
                  {% else %}
                    {% assign alt = 'Home Page Banner' %}
                  {% endif %}
                  {{
                    block.settings.mobile_banner_image
                    | image_url: width: 600
                    | image_tag: class: 'mobile-banner-image', loading: lazy, alt: alt
                  }}
                  <div class="mobile_banner_content {{ block.settings.content-position }}">
                    <div class="mobile_banner_content_div">
                      {% if block.settings.mobile_banner_text != blank %}
                        <h2 class="mobile_banner_text1">{{ block.settings.mobile_banner_text }}</h2>
                      {% endif %}
                      <div class="flex-11">
                        <a href="{{ block.settings.button_link1 }}">
                          <h3
                            class="mobile_button_text1"
                            style="background-color:{{ block.settings.buttoncolor }}; color:{{ block.settings.buttontextcolor }}"
                          >
                            {{ block.settings.button_text1 }}
                          </h3>
                        </a>
                      </div>
                    </div>
                  </div>
                {% endif %}
              </div>
            </div>
          {% endfor %}
        </div>
        <div class="swiper-pagination"></div>
      </div>
    </div>
  </section>
{% endif %}

<script>
  window.addEventListener(
    'DOMContentLoaded',
    () => {
      const mainBannerSwiper{{- section.id | remove: "--" | remove: "__" | remove: "-" }} = new Swiper(`#{{ section.id }} .main-banner-swiper`, {
        pagination: {
          el: ".swiper-pagination",
          clickable: true,
        },
        {% if section.settings.autoplay == true %}
          autoplay: {
            delay: 3000,
            disableOnInteraction: false,
          },
        {% endif %}
      });
    },{ once: true }
  );
</script>

{% schema %}
{
  "name": "Main Banner Image",
  "settings": [
    {
      "type": "range",
      "id": "margin_bottom_desktop",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Margin Bottom Desktop",
      "default": 36
    },
    {
      "type": "range",
      "id": "margin_bottom_mobile",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Margin Bottom Mobile",
      "default": 36
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Autoplay Enable/Disable"
    }
  ],
  "blocks": [
    {
      "type": "image",
      "name": "Banner Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "desktop_banner_image",
          "label": "Desktop Banner Image",
          "info": "Image size should be 1920px X 710px"
        },
        {
          "type": "select",
          "id": "desktop_media_type",
          "label": "Desktop Media Type",
          "options": [
            { "value": "image", "label": "Image" },
            { "value": "video", "label": "Video (upload mp4)" }
          ],
          "default": "image"
        },
        {
          "type": "video",
          "id": "desktop_banner_video",
          "label": "Desktop Banner Video",
          "info": "Upload an MP4 file here. Falls back to image if empty."
        },
        {
          "type": "image_picker",
          "id": "mobile_banner_image",
          "label": "Mobile Banner Image",
          "info": "Image size should be 770px X 900px"
        },
        {
          "type": "select",
          "id": "mobile_media_type",
          "label": "Mobile Media Type",
          "options": [
            { "value": "image", "label": "Image" },
            { "value": "video", "label": "Video (upload mp4)" }
          ],
          "default": "image"
        },
        {
          "type": "video",
          "id": "mobile_banner_video",
          "label": "Mobile Banner Video",
          "info": "Upload an MP4 file here. Falls back to image if empty."
        },
        {
          "type": "text",
          "id": "desktop_banner_text",
          "label": "Desktop Banner Text",
          "info": "Separate the text with double hash"
        },
        {
          "type": "text",
          "id": "mobile_banner_text",
          "label": "Mobile Banner Text"
        },
        {
          "type": "text",
          "id": "button_text1",
          "label": "Text for Button 1"
        },
        {
          "type": "url",
          "id": "button_link1",
          "label": "Link for Button 1"
        },

        {
          "type": "color",
          "id": "buttoncolor",
          "label": "Button Background Color"
        },
        {
          "type": "color",
          "id": "buttontextcolor",
          "label": "Button Text Color"
        },

        {
          "type": "select",
          "id": "content-position",
          "label": "Content Position",
          "options": [
            {
              "value": "top-left",
              "label": "Top-Left"
            },
            {
              "value": "top-center",
              "label": "Top-Center"
            },
            {
              "value": "top-right",
              "label": "Top-Right"
            },
            {
              "value": "middle-left",
              "label": "Middle-Left"
            },
            {
              "value": "middle-center",
              "label": "Middle-Center"
            },
            {
              "value": "middle-right",
              "label": "Middle-Right"
            },
            {
              "value": "bottom-left",
              "label": "Bottom-Left"
            },
            {
              "value": "bottom-center",
              "label": "Bottom-Center"
            },
            {
              "value": "bottom-right",
              "label": "Bottom-Right"
            }
          ],
          "default": "bottom-center"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Custom Main Banner Image"
    }
  ]
}
{% endschema %}
